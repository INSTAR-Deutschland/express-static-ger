var express=require("express"),searchRouter=express.Router(),elasticsearch=require("elasticsearch"),connectionString="localhost:9200",_index="wiki2_en",_type="article",client=new elasticsearch.Client({host:connectionString,log:"trace"});searchRouter.route("/").get(function(e,r){r.render("Search",{title:"INSTAR Wiki Search",breadcrumbs:'<li class="breadcrumb-item"><a href="/">Home</a></li><li class="breadcrumb-item"><a href="/Search/">Search</a></li>'})}),searchRouter.route("/Results").get(function(e,r){var a=e.query.agg_value,t=e.query.agg_field,s={};s[t]=a,client.search({index:_index,type:_type,body:{query:{filtered:{query:{multi_match:{query:e.query.q,fields:["title^100","tags^50","abstract^20","description^10","models^5","chapter^5","title2^5"],fuzziness:1}},filter:{term:t?s:void 0}}},aggs:{title:{terms:{field:"title.raw"}},tags:{terms:{field:"tags.raw"}},abstract:{terms:{field:"abstract.raw"}},title2:{terms:{field:"title2.raw"}},chapter:{terms:{field:"chapter.raw"}}}}}).then(function(a){r.render("Search_Results",{title:"INSTAR Wiki Search Results",response:a,query:e.query.q,breadcrumbs:'<li class="breadcrumb-item"><a href="/">Home</a></li><li class="breadcrumb-item"><a href="/Search/">Search</a></li><li class="breadcrumb-item"><a href="/Search/Results/">Search Results</a></li>'})},function(e){console.trace(e.message),r.render("Search_Results",{title:"INSTAR Wiki Search Results",response:e.message,breadcrumbs:'<li class="breadcrumb-item"><a href="/">Home</a></li><li class="breadcrumb-item"><a href="/Search/">Search</a></li><li class="breadcrumb-item"><a href="/Search/Results/">Search Results</a></li>'})})}),module.exports=searchRouter;